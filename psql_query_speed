-- function to determine the speed of query, pass the nuber of iterations desired and the query in question as a string
-- note that statistics may fudge up results slightly.

CREATE OR REPLACE FUNCTION queryRunTime (n integer, expression varchar)
  RETURNS DOUBLE PRECISION AS $$
DECLARE
  totalTime NUMERIC(10, 3) := 0;
  iteration INTEGER := 0 ;
  StartTime timestamptz;
  EndTime timestamptz;
  trash integer;
BEGIN

  WHILE iteration < n LOOP
    iteration := iteration + 1;
    StartTime := clock_timestamp();

    execute expression;

    EndTime := clock_timestamp();
    totalTime := totalTime + 1000 * (extract(epoch from EndTime) - extract(epoch from StartTime));
  END LOOP ;

  RETURN totalTime ;
END ;
$$ LANGUAGE plpgsql;
